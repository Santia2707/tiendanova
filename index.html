<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nova Shop</title>
  <style>
    /* ----------- ESTILOS GENERALES ----------- */
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin:0; 
      background:#f4f6f9; 
      color:#333;
    }
    header { 
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color:#fff; 
      padding:15px; 
      display:flex; 
      flex-wrap:wrap;
      justify-content:space-between; 
      align-items:center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    header h1 { margin:0; font-size:1.8em; }
    nav { display:flex; flex-wrap:wrap; gap:10px; }
    nav button { 
      padding:10px 18px; 
      border:none; 
      border-radius:25px; 
      background:#3498db; 
      color:#fff; 
      cursor:pointer; 
      transition:0.3s;
      font-weight:bold;
    }
    nav button:hover { background:#2980b9; transform:scale(1.05); }

    .container { padding:20px; max-width:1200px; margin:auto; }
    section { margin-bottom:30px; }

    /* ----------- PRODUCTOS ----------- */
    .products { 
      display:grid; 
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); 
      gap:20px; 
    }
    .product { 
      background:#fff; 
      border-radius:15px; 
      padding:15px; 
      box-shadow:0 4px 10px rgba(0,0,0,0.1); 
      text-align:center; 
      transition:0.3s;
    }
    .product:hover { transform:translateY(-5px); }
    .product img { width:100%; height:180px; object-fit:cover; border-radius:10px; }
    .product h4 { margin:10px 0; }
    .product button { 
      background:#27ae60; 
      color:#fff; 
      border:none; 
      padding:10px 15px; 
      margin-top:10px; 
      cursor:pointer; 
      border-radius:8px; 
      transition:0.3s;
    }
    .product button:hover { background:#1e8449; transform:scale(1.05); }

    /* ----------- TABLAS ----------- */
    table { width:100%; border-collapse: collapse; background:#fff; border-radius:10px; overflow:hidden; }
    th, td { padding:12px; border-bottom:1px solid #eee; text-align:center; font-size:0.95em; }
    th { background:#3498db; color:#fff; }
    .qtyBtn { 
      padding:5px 10px; 
      background:#3498db; 
      color:white; 
      border:none; 
      border-radius:5px; 
      cursor:pointer; 
      font-size:1em;
      margin:0 5px;
    }
    .qtyBtn:hover { background:#2980b9; }

    /* ----------- FORMULARIOS ----------- */
    form { 
      background:#fff; 
      padding:20px; 
      border-radius:15px; 
      box-shadow:0 4px 10px rgba(0,0,0,0.1); 
      max-width:450px; 
      margin:auto; 
    }
    form input, form select { 
      width:100%; 
      padding:12px; 
      margin-bottom:15px; 
      border:1px solid #ccc; 
      border-radius:8px; 
      font-size:1em; 
    }
    form button { 
      background:#27ae60; 
      color:#fff; 
      border:none; 
      padding:12px; 
      width:100%; 
      cursor:pointer; 
      border-radius:8px; 
      font-size:1em; 
      font-weight:bold; 
      transition:0.3s;
    }
    form button:hover { background:#1e8449; }

    /* ----------- HISTORIAL ----------- */
    .history-card {
      background:#fff; 
      padding:15px; 
      margin:15px 0; 
      border-radius:10px; 
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
    }
    .history-card h4 { margin-top:0; }

    /* ----------- RESPONSIVE ----------- */
    @media (max-width:600px) {
      header { flex-direction:column; text-align:center; }
      nav { justify-content:center; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Nova Shop</h1>
    <nav>
      <button onclick="showSection('products')">Productos</button>
      <button onclick="showSection('cart')">Carrito (<span id="cartCount">0</span>)</button>
      <button onclick="showSection('history')">Historial</button>
      <button onclick="showSection('auth')">Cuenta</button>
    </nav>
  </header>

  <div class="container">
    <!-- Productos -->
    <section id="products">
      <h2>üõçÔ∏è Productos</h2>
      <div class="products" id="productList"></div>
    </section>

    <!-- Carrito -->
    <section id="cart" style="display:none;">
      <h2>üõí Carrito</h2>
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody id="cartItems"></tbody>
      </table>
      <h3>Total: $<span id="cartTotal">0</span></h3>
      <button onclick="checkout()" id="checkoutBtn">Finalizar Compra</button>
    </section>

    <!-- Pago -->
    <section id="checkout" style="display:none;">
      <h2>üí≥ Finalizar Compra</h2>
      <form id="paymentForm">
        <label for="paymentMethod">M√©todo de Pago</label>
        <select id="paymentMethod" required onchange="togglePaymentFields()">
          <option value="">Seleccione...</option>
          <option value="card">Tarjeta de Cr√©dito/D√©bito</option>
          <option value="paypal">PayPal</option>
        </select>

        <div id="cardFields" class="hidden">
          <input type="text" placeholder="N√∫mero de tarjeta" maxlength="16">
          <input type="text" placeholder="MM/AA">
          <input type="text" placeholder="CVV" maxlength="3">
        </div>

        <div id="paypalFields" class="hidden">
          <input type="email" placeholder="Correo PayPal">
          <input type="password" placeholder="Contrase√±a PayPal">
        </div>

        <button type="submit">Confirmar Pago</button>
      </form>
    </section>

    <!-- Historial -->
    <section id="history" style="display:none;">
      <h2>üìú Historial de Compras</h2>
      <div id="historyList"></div>
    </section>

    <!-- Login/Registro -->
    <section id="auth" style="display:none;">
      <h2>üîê Acceso a tu cuenta</h2>
      <div id="authForms">
        <div>
          <h3>Crear Cuenta</h3>
          <input type="text" id="registerUser" placeholder="Usuario">
          <input type="password" id="registerPass" placeholder="Contrase√±a">
          <button onclick="register()">Registrarse</button>
        </div>
        <br>
        <div>
          <h3>Iniciar Sesi√≥n</h3>
          <input type="text" id="loginUser" placeholder="Usuario">
          <input type="password" id="loginPass" placeholder="Contrase√±a">
          <button onclick="login()">Ingresar</button>
        </div>
      </div>
      <div id="welcome" class="hidden">
        <h3>Bienvenido, <span id="userName"></span> üéâ</h3>
        <button onclick="logout()">Cerrar Sesi√≥n</button>
      </div>
    </section>
  </div>

  <script>
    const products = [
      {id:1, name:"Camisa Nova", price:25, img:"https://via.placeholder.com/250x180"},
      {id:2, name:"Pantal√≥n Moderno", price:40, img:"https://via.placeholder.com/250x180"},
      {id:3, name:"Zapatos Trend", price:60, img:"https://via.placeholder.com/250x180"},
      {id:4, name:"Mochila Casual", price:30, img:"https://via.placeholder.com/250x180"}
    ];

    let users = JSON.parse(localStorage.getItem("users")) || {};
    let currentUser = localStorage.getItem("currentUser");

    const productList = document.getElementById("productList");
    products.forEach(p=>{
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${p.img}" alt="${p.name}">
        <h4>${p.name}</h4>
        <p>$${p.price}</p>
        <button onclick="addToCart(${p.id})">Agregar al Carrito</button>
      `;
      productList.appendChild(div);
    });

    function getCart(){
      return currentUser && users[currentUser]?.cart ? users[currentUser].cart : [];
    }
    function saveCart(cart){
      if(currentUser){
        users[currentUser].cart = cart;
        localStorage.setItem("users", JSON.stringify(users));
      }
    }

    function showSection(id){
      document.querySelectorAll("section").forEach(s=>s.style.display="none");
      document.getElementById(id).style.display="block";
      if(id==="cart") renderCart();
      if(id==="auth") updateAuthView();
      if(id==="history") renderHistory();
    }

    function addToCart(id){
      if(!currentUser){ alert("Debes iniciar sesi√≥n para agregar al carrito."); return; }
      let cart = getCart();
      const product = products.find(p=>p.id===id);
      const found = cart.find(item=>item.id===id);
      if(found){ found.qty++; } else { cart.push({...product, qty:1}); }
      saveCart(cart);
      updateCartCount();
    }

    function renderCart(){
      let cart = getCart();
      const cartItems = document.getElementById("cartItems");
      cartItems.innerHTML = "";
      let total = 0;
      cart.forEach(item=>{
        const subtotal = item.price * item.qty;
        total += subtotal;
        cartItems.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>$${item.price}</td>
            <td>
              <button class="qtyBtn" onclick="changeQty(${item.id}, -1)">-</button>
              ${item.qty}
              <button class="qtyBtn" onclick="changeQty(${item.id}, 1)">+</button>
            </td>
            <td>$${subtotal}</td>
          </tr>`;
      });
      document.getElementById("cartTotal").textContent = total;
    }

    function changeQty(id, delta){
      let cart = getCart();
      const item = cart.find(p=>p.id===id);
      if(item){
        item.qty += delta;
        if(item.qty<=0) cart = cart.filter(p=>p.id!==id);
        saveCart(cart);
        renderCart();
        updateCartCount();
      }
    }

    function updateCartCount(){
      let cart = getCart();
      let count = cart.reduce((sum,p)=>sum+p.qty,0);
      document.getElementById("cartCount").textContent = count;
    }
    updateCartCount();

    function checkout(){
      let cart = getCart();
      if(cart.length===0){ alert("Tu carrito est√° vac√≠o"); return; }
      showSection('checkout');
    }

    function togglePaymentFields(){
      const method = document.getElementById("paymentMethod").value;
      document.getElementById("cardFields").classList.add("hidden");
      document.getElementById("paypalFields").classList.add("hidden");
      if(method==="card") document.getElementById("cardFields").classList.remove("hidden");
      if(method==="paypal") document.getElementById("paypalFields").classList.remove("hidden");
    }

    document.getElementById("paymentForm").addEventListener("submit", function(e){
      e.preventDefault();
      const cart = getCart();
      const total = cart.reduce((sum,p)=>sum+(p.price*p.qty),0);
      const date = new Date().toLocaleString();
      if(currentUser){
        if(!users[currentUser].history) users[currentUser].history = [];
        users[currentUser].history.push({date, cart, total});
        saveCart([]); 
        localStorage.setItem("users", JSON.stringify(users));
      }
      alert("‚úÖ Pago realizado con √©xito. ¬°Gracias por tu compra!");
      updateCartCount();
      showSection('history');
    });

    function renderHistory(){
      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";
      if(!currentUser || !users[currentUser]?.history || users[currentUser].history.length===0){
        historyList.innerHTML = "<p>No tienes compras realizadas a√∫n.</p>";
        return;
      }
      users[currentUser].history.forEach(order=>{
        historyList.innerHTML += `
          <div class="history-card">
            <h4>Compra del ${order.date}</h4>
            <ul>
              ${order.cart.map(item=>`<li>${item.qty} x ${item.name} - $${item.price*item.qty}</li>`).join("")}
            </ul>
            <strong>Total: $${order.total}</strong>
          </div>`;
      });
    }

    function register(){
      const user = document.getElementById("registerUser").value;
      const pass = document.getElementById("registerPass").value;
      if(users[user]){ alert("El usuario ya existe"); return; }
      users[user] = {password: pass, cart: [], history: []};
      localStorage.setItem("users", JSON.stringify(users));
      alert("Cuenta creada. Ahora inicia sesi√≥n.");
    }

    function login(){
      const user = document.getElementById("loginUser").value;
      const pass = document.getElementById("loginPass").value;
      if(users[user] && users[user].password===pass){
        currentUser = user;
        localStorage.setItem("currentUser", user);
        updateAuthView();
        updateCartCount();
      } else { alert("Datos incorrectos"); }
    }

    function logout(){
      currentUser = null;
      localStorage.removeItem("currentUser");
      updateAuthView();
      updateCartCount();
    }

    function updateAuthView(){
      if(currentUser){
        document.getElementById("authForms").classList.add("hidden");
        document.getElementById("welcome").classList.remove("hidden");
        document.getElementById("userName").textContent = currentUser;
      } else {
        document.getElementById("authForms").classList.remove("hidden");
        document.getElementById("welcome").classList.add("hidden");
      }
    }
  </script>
</body>
</html>
